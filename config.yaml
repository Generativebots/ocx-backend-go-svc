# =============================================================================
# OCX Go Backend - Master Configuration
# =============================================================================
#
# Environment-specific overrides:
#   - Copy to config.development.yaml or config.production.yaml
#   - Or use environment variables (they take precedence)
#
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
server:
  port: "${PORT:-8080}"
  env: "${OCX_ENV:-development}"
  interface: "${OCX_INTERFACE:-eth0}"

# -----------------------------------------------------------------------------
# Database Configuration (Supabase)
# -----------------------------------------------------------------------------
database:
  supabase:
    url: "${SUPABASE_URL}"
    service_key: "${SUPABASE_SERVICE_KEY}"

# -----------------------------------------------------------------------------
# Reputation Service
# -----------------------------------------------------------------------------
reputation:
  backend: "${REPUTATION_BACKEND:-supabase}"  # supabase, spanner, sqlite
  sqlite_path: "${REPUTATION_SQLITE_PATH:-./data/reputation.db}"
  spanner:
    project_id: "${SPANNER_PROJECT_ID}"
    instance_id: "${SPANNER_INSTANCE_ID}"
    database_id: "${SPANNER_DATABASE_ID}"

# -----------------------------------------------------------------------------
# Escrow Configuration
# -----------------------------------------------------------------------------
escrow:
  mode: "${ESCROW_MODE:-standard}"           # standard, strict, permissive
  entropy_threshold: "${ENTROPY_THRESHOLD:-0.85}"
  enable_live_capture: "${ENABLE_LIVE_CAPTURE:-false}"
  jury_service_addr: "${JURY_SERVICE_ADDR:-localhost:50051}"

# -----------------------------------------------------------------------------
# Trust Weights (Tri-Factor Gate)
# -----------------------------------------------------------------------------
trust:
  weights:
    audit: 0.4
    reputation: 0.3
    attestation: 0.2
    history: 0.1
  secrets:
    visual_key: "${VISUAL_SECRET_KEY:-default_visual_key}"
    test_key: "${TEST_SECRET_KEY:-default_test_key}"

# -----------------------------------------------------------------------------
# Handshake Configuration
# -----------------------------------------------------------------------------
handshake:
  session_expiry_minutes: 5
  default_crypto_algorithm: "ed25519"   # ed25519 | ecdsa-p256 (tenant-overridable)
  supported_versions:
    - "1.0.0"
    - "1.1.0"

# -----------------------------------------------------------------------------
# Governance Configuration
# -----------------------------------------------------------------------------
governance:
  committee_size: 22
  quorum_percentage: 0.67
  voting_period_hours: 168    # 7 days

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------
network:
  initial_node_count: 150
  max_connections: 1000
  heartbeat_interval_ms: 5000

# -----------------------------------------------------------------------------
# Contracts Runtime
# -----------------------------------------------------------------------------
contracts:
  runtime_timeout_ms: 5000
  enforce_use_case_link: true
  max_active_contracts: 50
  sandbox_memory_mb: 256

# -----------------------------------------------------------------------------
# Monitoring & Alerts
# -----------------------------------------------------------------------------
monitoring:
  entropy_threshold: 0.85
  latency_alert_ms: 200
  enable_live_stream: true
  metrics_buffer_size: 10000

# -----------------------------------------------------------------------------
# Simulation & Impact Analysis
# -----------------------------------------------------------------------------
simulation:
  max_batch_size: 100
  retention_days: 30
  parallel_workers: 4

impact:
  monte_carlo_iterations: 1000
  confidence_level: 0.95

# -----------------------------------------------------------------------------
# Redis (Hub Store, Event Bus — multi-pod routing)
# Disabled by default; enable for multi-instance Cloud Run deployments
# -----------------------------------------------------------------------------
redis:
  addr: "${OCX_REDIS_ADDR:-localhost:6379}"
  password: "${OCX_REDIS_PASSWORD:-}"
  db: 0
  enabled: false   # Set true (or OCX_REDIS_ENABLED=true) in production

# -----------------------------------------------------------------------------
# Security — Token Broker (Claim 7) + Continuous Access Evaluator (Claim 8)
# IMPORTANT: Set OCX_HMAC_SECRET to a strong random value in production!
# -----------------------------------------------------------------------------
security:
  hmac_secret: "${OCX_HMAC_SECRET:-change-me-in-production}"
  token_ttl_sec: 300
  min_trust_for_token: 0.65
  max_tokens_per_agent: 50
  cae_sweep_interval_sec: 10
  drift_threshold: 0.20
  trust_drop_limit: 0.15
  anomaly_threshold: 5

# -----------------------------------------------------------------------------
# Sovereign Mode (Claim 12) — local-only operation
# -----------------------------------------------------------------------------
sovereign:
  enabled: false
  local_inference_endpoint: "${OCX_LOCAL_INFERENCE_ENDPOINT:-}"
  boundary_enforced: false

# -----------------------------------------------------------------------------
# Python Service URLs (for Go → Python communication)
# On Cloud Run, each service has its own URL and listens on :8000
# For local dev, use distinct ports to avoid conflicts
# -----------------------------------------------------------------------------
services:
  trust_registry_url: "${TRUST_REGISTRY_URL:-http://localhost:8000}"
  jury_grpc_addr: "${JURY_SERVICE_ADDR:-localhost:8001}"
  activity_registry_url: "${ACTIVITY_REGISTRY_URL:-http://localhost:8002}"
  evidence_vault_url: "${EVIDENCE_VAULT_URL:-http://localhost:8003}"
  authority_url: "${AUTHORITY_URL:-http://localhost:8004}"
  monitor_url: "${MONITOR_URL:-http://localhost:8005}"
  ledger_url: "${LEDGER_URL:-http://localhost:8006}"


